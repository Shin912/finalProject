<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hereo.project.dao.StadiumDAO">
	<select id="selectBoardList" resultType="com.hereo.project.vo.StadiumVO">
  		select * 
  			from stadium
  			join region_detail on sd_rd_num = rd_num
  			join members on sd_me_id = me_id
  			where 
  				(sd_name like concat('%',#{cri.search} ,'%')
  				or sd_intro like concat('%',#{cri.search} ,'%'))
  			order by sd_num desc
  			limit #{cri.pageStart}, #{cri.perPageNum}
  	</select>
  	<select id ="selectStadiumList" resultType="com.hereo.project.vo.StadiumVO">
  		select * from `stadium`
  			join `region_detail` on sd_rd_num = rd_num
  			join `region_sub` on rd_rs_num = rs_num
  			where
  				rs_re_num = #{r}
  	</select>
  	<select id="selectStadiumTotalCount" resultType="int">
  		select count(*) from stadium
  			where
  				(sd_name like concat('%',#{cri.search} ,'%')
  				or sd_intro like concat('%',#{cri.search} ,'%'))
  	</select>
  	<select id="selectStadium" resultType="com.hereo.project.vo.StadiumVO">
  		select * from stadium
	  		join region_detail on sd_rd_num = rd_num
	  		join members on sd_me_id = me_id
	  			where sd_num = #{sd_num}
	 			order by sd_num desc
  	</select>
	
	<select id="selectFileList" resultType="com.hereo.project.vo.StadiumImageVO">
		select * from `stadium-image` where si_sd_num = #{sd_num}
	</select>
	<select id="selectStadiumTimetableList" resultType="com.hereo.project.vo.StadiumTimetableVO">
		select * from `stadium-timetable`
	</select>
	<!-- 스타디움 등록 -->
	<insert id="insertStadium">
	    <![CDATA[
	        INSERT INTO stadium(sd_rd_num, sd_name, sd_register_date, sd_contact, sd_me_id, sd_price, sd_intro)
	        VALUES (#{stadium.sd_rd_num}, #{stadium.sd_name}, NOW(), #{stadium.sd_contact},
          #{stadium.sd_me_id}, #{stadium.sd_price}, #{stadium.sd_intro})
	    ]]>
	</insert>
	
	<!-- 스타디움 이미지 등록 -->
	<insert id="insertStadiumImage">
	    <![CDATA[
	        INSERT INTO stadium_image(sd_num, si_filename)
	        VALUES (#{sd_num}, #{si_filename})
	    ]]>
	</insert>
	<select id="selectRegionDetail" resultType="int">
		select * from region_detail
			join region_sub on rd_rs_num = rs_num
				where rd_num = #{rd_num}
	</select>
	<!-- 스타디움 스케쥴 가져오기 -->
	<select id="selectStadiumTimetable" resultType="com.hereo.project.vo.StadiumTimetableVO">
		select * from `stadium-timetable` where st_sd_num=#{st}
	</select>
	<!--  결제를 위한 스타디움 타임 스케쥴 가져오기 -->
	<select id="getStadiumTimetableForPay" resultType="com.hereo.project.vo.StadiumTimetableVO">
		select * from `stadium-timetable`
			where st_num=#{st_num}  
	</select>
	<select id="checkStadiumSchedule" resultType="com.hereo.project.vo.StadiumScheduleVO">
		select * from `stadium-schedule`
			where ss_st_num = #{st_num} and ss_game_date = #{date} and ss_state=#{state}
	</select>
	<insert id="insertReservation" useGeneratedKeys="true" keyProperty="re.rv_num">
		insert into reservation(rv_me_id, rv_payment_amount, rv_isReferee, rv_isRecoder, rv_total_price, rv_game_type, rv_home_num, rv_away_num)
		values(#{re.rv_me_id},#{re.rv_payment_amount},#{re.rv_isReferee},#{re.rv_isRecoder},#{re.rv_total_price},#{re.rv_game_type},#{re.rv_home_num}, #{re.rv_away_num})
	</insert>
	<insert id="insertStadiumSchedule">
		insert into `stadium-schedule`(ss_st_num, ss_rv_num, ss_game_date)
		values(#{st_num},#{rv_num},#{date, jdbcType=DATE})
	</insert>
	<select id="selectReservation" resultType="com.hereo.project.vo.ReservationVO">
		select * from `reservation` 
		where rv_num=#{rv_num}
	</select>
	<delete id="deleteReservation" parameterType="int">
		delete ss, re
		from `stadium-schedule` ss
		join `reservation` re on ss.ss_rv_num = re.rv_num
		where ss.ss_rv_num=#{rv_num}
		and re.rv_num=#{rv_num}
	</delete>
	<select id="searchStadiumSchedule" resultType="com.hereo.project.vo.StadiumScheduleVO">
		select * from `stadium-schedule`
		where ss_rv_num=#{rv_num}
	</select>
	<select id="checkCompletePayList" resultType="com.hereo.project.vo.StadiumScheduleVO">
		select * from `stadium-schedule`
		where ss_st_num=#{ss_st_num} and ss_game_date=#{ss_game_date} and ss_state=#{ss_state}
	</select>
	<update id="updateState">
		update `stadium-schedule`
		set ss_state=#{state}, ss_receipt_id=#{receipt_id}
		where ss_rv_num=#{rv_num}
	</update>
</mapper>


